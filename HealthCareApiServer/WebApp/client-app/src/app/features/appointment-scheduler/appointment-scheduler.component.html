<div class="grid grid-cols-1 lg:grid-cols-[380px_1fr] gap-6">
  <!-- Left: List -->
  <section class="card bg-white p-4 md:p-6">
    <div class="flex items-center gap-2 mb-4">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-5 h-5 text-slate-500">
        <path fill-rule="evenodd" d="M10.5 3.75a6.75 6.75 0 1 0 3.93 12.285l4.767 4.768a.75.75 0 1 0 1.06-1.06l-4.768-4.767A6.75 6.75 0 0 0 10.5 3.75ZM5.25 10.5a5.25 5.25 0 1 1 10.5 0 5.25 5.25 0 0 1-10.5 0Z" clip-rule="evenodd" />
      </svg>
      <input id="search" type="text" [placeholder]="isDoctor ? 'Search patient by name or email' : 'Search name or department'"
        [(ngModel)]="search"
        class="w-full border border-slate-200 rounded-xl px-3 py-2 outline-none focus:ring-2 focus:ring-slate-300" />
    </div>

    <div id="selectorList" class="space-y-3 max-h-[70vh] overflow-auto scrollbar-thin">
      <ng-container *ngIf="isDoctor; else doctorList">
        <ng-container *ngIf="filteredPatients.length; else noPatients">
          <button *ngFor="let p of filteredPatients; trackBy: trackByPatient"
                  (click)="onPatientSelect(p)"
                  class="w-full text-left p-3 border border-slate-200 hover:bg-slate-50 rounded-2xl flex gap-3 items-center"
                  [ngClass]="{'ring-2 ring-slate-900 bg-slate-900/5': selectedPatient?.id === p.id}">
            <div class="w-14 h-14 flex items-center justify-center bg-slate-100 rounded-xl ring-1 ring-slate-200 text-slate-600 font-semibold">
              {{ (p.firstName || '?').charAt(0) }}
            </div>
            <div class="flex-1">
              <div class="font-medium">{{ p.fullName || (p.firstName + ' ' + p.lastName) }}</div>
              <div class="text-sm text-slate-600 truncate">{{ p.email || '—' }}</div>
            </div>
          </button>
        </ng-container>
        <ng-template #noPatients>
          <div class="text-sm text-slate-500">No patients match your search.</div>
        </ng-template>
      </ng-container>
      <ng-template #doctorList>
        <ng-container *ngIf="filteredDoctors.length; else noDocs">
          <button *ngFor="let d of filteredDoctors; trackBy: trackByDoctor"
                  (click)="onDoctorSelect(d)"
                  class="w-full text-left p-3 border border-slate-200 hover:bg-slate-50 rounded-2xl flex gap-3 items-center"
                  [ngClass]="{'ring-2 ring-slate-900 bg-slate-900/5': selectedDoctor?.id === d.id}">
            <img [src]="'https://images.unsplash.com/photo-1550831107-1553da8c8464?q=80&w=640&auto=format&fit=crop'" [alt]="d.firstName" class="w-14 h-14 object-cover rounded-xl ring-1 ring-slate-200" />
            <div class="flex-1">
              <div class="font-medium">{{ d.firstName + ' ' + d.lastName }}</div>
              <div class="text-sm text-slate-600">{{ d.departmentName }}</div>
            </div>
          </button>
        </ng-container>
        <ng-template #noDocs>
          <div class="text-sm text-slate-500">No doctors match your search.</div>
        </ng-template>
      </ng-template>
    </div>
  </section>

  <!-- Right: Details & Booking -->
  <section class="space-y-6">
    <!-- Details card -->
    <div class="card bg-white p-4 md:p-6" id="doctorDetails">
      <div class="flex items-start gap-4" *ngIf="!isDoctor; else patientInfo">
        <img [src]="'https://images.unsplash.com/photo-1550831107-1553da8c8464?q=80&w=640&auto=format&fit=crop'" alt="Doctor photo" class="w-24 h-24 object-cover rounded-2xl ring-1 ring-slate-200" />
        <div class="flex-1">
          <h2 class="text-xl font-semibold">{{ selectedDoctor?.firstName + ' ' + selectedDoctor?.lastName || 'Select a doctor' }}</h2>
          <p class="text-slate-600">{{ selectedDoctor?.departmentName || '—' }}</p>
        </div>
      </div>
      <ng-template #patientInfo>
        <div class="flex items-start gap-4">
          <div class="w-24 h-24 flex items-center justify-center bg-slate-100 rounded-2xl ring-1 ring-slate-200 text-2xl font-semibold text-slate-600">
            {{ (selectedPatient?.firstName || '?').charAt(0) }}
          </div>
          <div class="flex-1">
            <h2 class="text-xl font-semibold">{{ selectedPatient?.fullName || 'Select a patient' }}</h2>
            <p class="text-slate-600">{{ selectedPatient?.email || '—' }}</p>
          </div>
        </div>
      </ng-template>
    </div>

    <!-- Calendar + time slots -->
    <div class="card bg-white p-4 md:p-6">
      <div class="flex flex-col md:flex-row md:items-start gap-6">
        <!-- Calendar -->
        <div class="md:w-[360px]">
          <app-calendar [doctorId]="selectedDoctor?.id || 0"
                        [dates]="dates"
                        (dateSelected)="onDateSelect($event)"
                        (viewChanged)="onViewChange()"></app-calendar>
        </div>

        <!-- Time slots & booking -->
        <div class="flex-1">
          <h4 class="font-semibold mb-2">Available time slots</h4>
          <div class="text-slate-600 mb-3">{{ dateLabel }}</div>

          <ng-container *ngIf="!(isDoctor && !selectedPatient); else selectPatientFirst">
            <div id="slots" class="flex flex-wrap gap-2">
              <ng-container *ngIf="slotsForSelected.length; else noSlots">
                <button *ngFor="let t of slotsForSelected; trackBy: trackByIndex"
                        (click)="selectTime(t)"
                        class="slot-btn btn px-3 py-2 border border-slate-200 hover:bg-slate-50"
                        [ngClass]="{'ring-2 ring-slate-900 bg-slate-900/5': selectedTime === t}">
                  {{ t }}
                </button>
              </ng-container>
              <ng-template #noSlots>
                <div class="text-slate-500">No hours on this date.</div>
              </ng-template>
            </div>
          </ng-container>
          <ng-template #selectPatientFirst>
            <div class="text-slate-500">Select a patient to view available time slots.</div>
          </ng-template>

          <!-- <div class="mt-6 border-t pt-4">
            <h4 class="font-semibold mb-2">Reason</h4>
            <input type="text"
                class="w-full border border-slate-200 rounded-xl px-3 py-2 outline-none focus:ring-2 focus:ring-indigo-300 text-sm"
                placeholder="Add a quick note…" />
          </div> -->

          <div class="mt-6 border-t pt-4">
            <h4 class="font-semibold mb-2">Appointment summary</h4>
            <div class="text-slate-700">{{ summary }}</div>
            <button (click)="book()"
                    class="btn mt-4 px-4 py-2 bg-slate-900 text-white hover:opacity-90 disabled:opacity-40"
                    [disabled]="!(selectedDoctor && selectedDate && selectedTime && (!isDoctor || selectedPatient))">
              Book appointment
            </button>
            <p *ngIf="bookedOk" class="mt-3 text-green-700 font-medium">✓ Appointment booked!</p>
          </div>
        </div>
      </div>
    </div>
  </section>
</div>
